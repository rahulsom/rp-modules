buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
    }

    dependencies {
        classpath 'com.netflix.nebula:gradle-extra-configurations-plugin:4.0.1'
        classpath "com.bmuschko:gradle-nexus-plugin:2.3.1"
        classpath "io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.5.3"
        classpath "com.netflix.nebula:nebula-release-plugin:6.2.0"
        classpath "io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.5.3"
    }
}

apply plugin: "nebula.release"
apply plugin: 'io.codearte.nexus-staging'

subprojects {

    apply plugin: 'nebula.provided-base'
    apply plugin: 'java'
    apply plugin: 'groovy'

    group = "com.github.rahulsom"

    repositories {
        jcenter()
    }

    dependencies {
        provided 'io.ratpack:ratpack-core:1.5.4'
        provided 'io.ratpack:ratpack-guice:1.2.0'

        testCompile 'io.ratpack:ratpack-test:1.5.4'
        testCompile "org.codehaus.groovy:groovy-all:2.5.3"
        testCompile "org.spockframework:spock-core:1.0-groovy-2.4"
    }

}

tasks.findByName('release').dependsOn ':rp-config:uploadArchives', ':rp-i18n-json:uploadArchives'


project.afterEvaluate {
    project.tasks.findByName('closeRepository').mustRunAfter ':rp-config:uploadArchives', ':rp-i18n-json:uploadArchives'

    if (!version.toString().endsWith('-SNAPSHOT')) {
        tasks.release.dependsOn 'closeAndPromoteRepository'
    }
}

nexusStaging {
    delayBetweenRetriesInMillis = 10000
    numberOfRetries = 30
}